# Phase 1.4: API Testing Screen

## Objective

Build a comprehensive developer tool for testing all middleware API functions before integrating them into production screens.

## Prerequisites

- Phase 1.2 (Design System) completed
- Phase 1.3 (API Middleware) completed
- Understanding of all API endpoints

## Screen Details

**Screen Name:** `== [API Tester] ==`

**Purpose:** Validate that middleware functions correctly communicate with backend APIs

## Features

### 1. Function Selector
- Category-based organization (Apps, Screens, Data Sources, Files, Merge Ops)
- Dropdown to select specific API function
- Display function signature and description

### 2. Parameter Editor
- Dynamic form generation based on function signature
- Support for text inputs, numbers, booleans, arrays, objects
- Required/optional field indicators
- Default values pre-filled

### 3. Request Preview
- Show constructed URL
- Display HTTP method
- Show headers
- Display request body (formatted JSON)

### 4. Execute & Response
- Execute button to trigger API call
- Response display with formatted JSON
- Response time measurement
- Status code display (200, 400, 404, etc.)

### 5. Request History
- Log of recent API calls (last 20)
- Success/error indicators
- Click to replay a request
- Duration tracking

### 6. Quick Test Scenarios
- Pre-configured parameter sets for common use cases
- Example: "Get Dev Org Apps", "Check for Duplicates"
- Dropdown to load scenario parameters

## Implementation Structure

```html
<div id="api-tester" class="container-fluid">
  <div class="row">
    <!-- Left Panel: Function Selection & Parameters -->
    <div class="col-md-6">
      <merge-card title="API Function Tester">
        <!-- Category Tabs -->
        <ul class="nav nav-tabs">
          <li><a data-toggle="tab" href="#apps">Apps</a></li>
          <li><a data-toggle="tab" href="#screens">Screens</a></li>
          <li><a data-toggle="tab" href="#datasources">Data Sources</a></li>
          <li><a data-toggle="tab" href="#files">Files</a></li>
          <li><a data-toggle="tab" href="#merge">Merge Ops</a></li>
        </ul>

        <!-- Function Dropdown -->
        <select id="function-select">...</select>

        <!-- Dynamic Parameter Form -->
        <div id="parameters-form">...</div>

        <!-- Quick Scenarios -->
        <select id="scenario-select">...</select>

        <!-- Actions -->
        <merge-button variant="primary" @click="execute">
          Execute
        </merge-button>
      </merge-card>
    </div>

    <!-- Right Panel: Request/Response -->
    <div class="col-md-6">
      <!-- Request Preview Card -->
      <merge-card title="Request Preview">
        <pre id="request-preview"></pre>
      </merge-card>

      <!-- Response Card -->
      <merge-card title="Response">
        <template #header>
          <merge-badge :variant="responseStatus">{{ statusCode }}</merge-badge>
          <span>{{ responseTime }}ms</span>
        </template>
        <pre id="response-display"></pre>
      </merge-card>

      <!-- History Card -->
      <merge-card title="Request History">
        <div id="history-list">...</div>
      </merge-card>
    </div>
  </div>
</div>
```

## Vue Component Logic

```javascript
var ApiTesterScreen = {
  data: function() {
    return {
      categories: {
        apps: ['getApps', 'getAppDetails', 'checkDuplicates'],
        screens: ['getScreens', 'getScreenDetails'],
        datasources: ['getDataSources', 'getDataSourceDetails'],
        files: ['getFiles', 'getFileDetails', 'getFolderDetails'],
        merge: ['lockApps', 'unlockApps', 'extendLock', 'previewMerge', 'executeMerge', 'getMergeStatus']
      },
      selectedFunction: null,
      parameters: {},
      request: null,
      response: null,
      responseTime: null,
      statusCode: null,
      history: []
    };
  },
  methods: {
    selectFunction(functionName) {
      this.selectedFunction = functionName;
      this.renderParameterForm();
    },

    execute() {
      var startTime = Date.now();
      var fn = MergeAPI[this.selectedFunction];
      var args = this.buildArgumentsArray();

      fn.apply(MergeAPI, args)
        .then(function(response) {
          this.response = response;
          this.responseTime = Date.now() - startTime;
          this.statusCode = 200;
          this.addToHistory('success');
        }.bind(this))
        .catch(function(error) {
          this.response = { error: error.message };
          this.responseTime = Date.now() - startTime;
          this.statusCode = 'Error';
          this.addToHistory('error');
        }.bind(this));
    },

    addToHistory(status) {
      this.history.unshift({
        timestamp: new Date().toISOString(),
        function: this.selectedFunction,
        status: status,
        request: this.request,
        response: this.response,
        duration: this.responseTime
      });

      if (this.history.length > 20) {
        this.history = this.history.slice(0, 20);
      }
    }
  }
};
```

## Test Scenarios

### Apps Category
```javascript
scenarios: {
  getApps: [
    {
      name: 'Dev Org Apps',
      params: { organizationId: 456, publisher: true, mergeable: true }
    },
    {
      name: 'All Org Apps',
      params: { organizationId: 456 }
    }
  ],
  checkDuplicates: [
    {
      name: 'Check Pages & DS',
      params: { appId: 123, items: ['pages', 'datasources'] }
    }
  ]
}
```

### Screens Category
```javascript
scenarios: {
  getScreens: [
    {
      name: 'All Screens',
      params: { appId: 123 }
    },
    {
      name: 'Screens with Associations',
      params: { appId: 123, include: ['associatedDS', 'associatedFiles'] }
    }
  ]
}
```

### Merge Operations Category
```javascript
scenarios: {
  lockApps: [
    {
      name: 'Lock for 10 mins',
      params: {
        sourceAppId: 123,
        targetApp: { id: 456, region: 'us' },
        lockedUntil: Date.now() + 10 * 60 * 1000
      }
    }
  ]
}
```

## CSS Styling

```css
.code-preview {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 4px;
  font-family: 'Monaco', 'Courier New', monospace;
  font-size: 12px;
  max-height: 400px;
  overflow-y: auto;
}

.history-item {
  padding: 8px;
  border-left: 3px solid #ccc;
  margin-bottom: 8px;
  cursor: pointer;
}

.history-item.success {
  border-left-color: #28a745;
}

.history-item.error {
  border-left-color: #dc3545;
}
```

## Usage Workflow

1. Select API category (Apps, Screens, etc.)
2. Select specific function from dropdown
3. Fill in required/optional parameters
4. OR select a quick test scenario
5. Review the constructed request
6. Click "Execute"
7. View formatted response and timing
8. Review history to compare requests

## Benefits

- Validates API endpoints before building UI screens
- Tests error handling in middleware
- Understands response structures
- Documents API behavior
- Debugs parameter issues
- Provides examples for other developers

## Verification

- [ ] Screen is created and accessible
- [ ] All API categories are available
- [ ] Parameter forms generate correctly
- [ ] Request preview shows accurate information
- [ ] API calls execute successfully
- [ ] Responses display formatted JSON
- [ ] History tracks recent calls
- [ ] Quick scenarios work correctly

## Next Steps

Once API middleware is validated, proceed to [Phase 2: Screen-by-Screen Implementation](../phase-2-screens/2.1-dashboard.md).

## Related Documents

- [API Middleware Layer](./1.3-api-middleware.md)
- [API Technical Specification](../../05-api-tech-spec.md)
- [Phase 1 Overview](../00-overview.md#phase-1-foundation--design-system)

